@using Microsoft.Ajax.Utilities
@model contact_management.web.Models.ContactListViewModel

@{
  ViewBag.Title = "Index";
  bool forCompany = !Model.ForCompany.IsNullOrWhiteSpace();
}



@if (!forCompany)
{
  <h2>All Contacts</h2>
}
else
{
  <h2>Contacts for "@Model.ForCompany"</h2>
}

<p>
  @Html.ActionLink("Create New", "Create")


  @if (forCompany)
  {
    @Html.Raw("&nbsp;")
    @Html.ActionLink("Show All", "Index")
  }
</p>
<table class="table">
  <tr>
    <th>First Name</th>
    <th>Last Name</th>
    @if (!forCompany)
    {
    <th>Company</th>
    }
    <th>Title</th>
    <th>Email Address</th>
    <th></th>
  </tr>

  @foreach (var item in Model.OrderBy(c => c.Company).ThenBy(c => c.LastName).ThenBy(c => c.FirstName))
  {
    if (item.FirstName.IsNullOrWhiteSpace()) { continue;}
    if (item.LastName.IsNullOrWhiteSpace()) { continue;}
    if (item.Company.IsNullOrWhiteSpace()) { continue;}

  <tr>
    <td>@Html.DisplayFor(modelItem => item.FirstName)</td>
    <td>@Html.DisplayFor(modelItem => item.LastName)</td>
    @if (!forCompany)
    {
    <td>
      @Html.ActionLink(item.Company, "Index", "Contacts", new { company = item.Company }, null)
    </td>
    }
    <td>@Html.DisplayFor(modelItem => item.Title)</td>
    <td>@Html.DisplayFor(modelItem => item.EmailAddress)</td>
    <td>
      @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
      @Html.ActionLink("Details", "Details", new { id = item.Id }) |
      @Html.ActionLink("Delete", "Delete", new { id = item.Id })
    </td>
  </tr>
  }

</table>
